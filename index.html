<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–∫–æ-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <header>
        <h1>üåç –≠–∫–æ-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h1>
        <p>–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã</p>
    </header>

    <main>
        <section class="stats">
            <div class="stat-card">
                <h3>üíß –ü–∏—Ç—å–µ–≤–∞—è –≤–æ–¥–∞</h3>
                <div class="counter">2.5%</div>
                <p>–ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã –æ—Å—Ç–∞–ª–æ—Å—å</p>
            </div>
            <div class="stat-card">
                <h3>üî• –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∂–∞—Ä—ã</h3>
                <div id="fireCounter" class="counter">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <p>–æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å–ø—É—Ç–Ω–∏–∫–∞–º–∏</p>
            </div>
            <div class="stat-card">
                <h3>üå´Ô∏è –ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞</h3>
                <div id="airQuality" class="counter">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <p>—Å—Ç–∞–Ω—Ü–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</p>
            </div>
        </section>

        <section class="map-section">
            <h2>–ö–∞—Ä—Ç–∞ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h2>
            <div class="map-tabs">
                <button class="tab-btn active" onclick="showTab('air')">–ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞</button>
                <button class="tab-btn" onclick="showTab('fires')">–õ–µ—Å–Ω—ã–µ –ø–æ–∂–∞—Ä—ã</button>
            </div>
            <div id="map"></div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è -->
        <section id="historical-pollution" class="historical-section">
            <h2>üìä –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ (1800-2024)</h2>
            <div class="historical-controls">
                <div class="time-controls">
                    <label>–ì–æ–¥: <span id="currentYearDisplay">2024</span></label>
                    <input type="range" id="yearSlider" min="1800" max="2024" value="2024" class="timeline-slider">
                </div>
                <div class="data-type-buttons">
                    <button class="data-btn active" data-type="air">üå§Ô∏è –í–æ–∑–¥—É—Ö</button>
                    <button class="data-btn" data-type="water">üåä –í–æ–¥–∞</button>
                </div>
            </div>
            <div id="pollutionMap" style="height: 500px; margin: 20px 0; border-radius: 10px;"></div>
            <div class="pollution-info">
                <div id="pollutionStats" class="stats-card">
                    <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ <span id="statsYear">2024</span> –≥–æ–¥</h4>
                    <div id="airStats" class="stats-content">
                        <p>CO‚ÇÇ: <span id="co2Value">420</span> ppm</p>
                        <p>SO‚ÇÇ: <span id="so2Value">60</span> ¬µg/m¬≥</p>
                        <p>NO‚ÇÇ: <span id="no2Value">50</span> ¬µg/m¬≥</p>
                    </div>
                    <div id="waterStats" class="stats-content" style="display: none;">
                        <p>–°—Ç–∞–Ω—Ü–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: <span id="waterStationsCount">70</span></p>
                        <p>–°—Ä–µ–¥–Ω–µ–µ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ: <span id="avgWaterPollution">35</span>%</p>
                    </div>
                </div>
                <div class="legend">
                    <h4>–õ–µ–≥–µ–Ω–¥–∞</h4>
                    <div id="airLegend">
                        <div class="legend-item">
                            <span class="color-box air-excellent"></span>
                            <span>–û—Ç–ª–∏—á–Ω–æ–µ (0-12 ¬µg/m¬≥)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box air-good"></span>
                            <span>–•–æ—Ä–æ—à–µ–µ (12-35 ¬µg/m¬≥)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box air-moderate"></span>
                            <span>–£–º–µ—Ä–µ–Ω–Ω–æ–µ (35-55 ¬µg/m¬≥)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box air-poor"></span>
                            <span>–ü–ª–æ—Ö–æ–µ (55-150 ¬µg/m¬≥)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box air-very-poor"></span>
                            <span>–û—á–µ–Ω—å –ø–ª–æ—Ö–æ–µ (150+ ¬µg/m¬≥)</span>
                        </div>
                    </div>
                    <div id="waterLegend" style="display: none;">
                        <div class="legend-item">
                            <span class="color-box water-clean"></span>
                            <span>–ß–∏—Å—Ç–∞—è (0-20%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box water-moderate"></span>
                            <span>–£–º–µ—Ä–µ–Ω–Ω–∞—è (20-40%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box water-polluted"></span>
                            <span>–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–Ω–∞—è (40-60%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box water-heavy-polluted"></span>
                            <span>–°–∏–ª—å–Ω–æ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–Ω–∞—è (60%+)</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è -->
        <section class="pollution-impact">
            <h2>üíî –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã</h2>
            <div class="impact-stats">
                <div class="impact-card">
                    <h3>üêæ –ü–æ–≥–∏–±—à–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ</h3>
                    <div class="counter" id="animalDeaths">1.5 –º–ª–Ω</div>
                    <p>–≤ –≥–æ–¥ –∏–∑-–∑–∞ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã</p>
                    <div class="impact-details">
                        <p>‚Ä¢ 1 –º–ª–Ω –º–æ—Ä—Å–∫–∏—Ö –ø—Ç–∏—Ü</p>
                        <p>‚Ä¢ 100 —Ç—ã—Å –º–æ—Ä—Å–∫–∏—Ö –º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–∏—Ö</p>
                        <p>‚Ä¢ 400 —Ç—ã—Å –¥—Ä—É–≥–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö</p>
                    </div>
                </div>
                <div class="impact-card">
                    <h3>üë• –ü–æ–≥–∏–±—à–∏–µ –ª—é–¥–∏</h3>
                    <div class="counter" id="humanDeaths">9 –º–ª–Ω</div>
                    <p>–≤ –≥–æ–¥ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ–º</p>
                    <div class="impact-details">
                        <p>‚Ä¢ 4.2 –º–ª–Ω –æ—Ç –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –≤–æ–∑–¥—É—Ö–∞</p>
                        <p>‚Ä¢ 2.2 –º–ª–Ω –æ—Ç –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –≤–æ–¥—ã</p>
                        <p>‚Ä¢ 2.6 –º–ª–Ω –æ—Ç –¥—Ä—É–≥–∏—Ö –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ -->
        <section class="recycling-calculator">
            <h2>üå± –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤</h2>
            <div class="calc-tabs">
                <button class="calc-tab active" onclick="showRecyclingTab('general', event)">‚ôªÔ∏è –û–±—â–∏–π —Ä–∞—Å—á–µ—Ç</button>
                <button class="calc-tab" onclick="showRecyclingTab('batteries', event)">üîã –ë–∞—Ç–∞—Ä–µ–π–∫–∏</button>
                <button class="calc-tab" onclick="showRecyclingTab('bottles', event)">ü•§ –ë—É—Ç—ã–ª–∫–∏</button>
            </div>

            <div id="generalRecycling" class="recycling-form active">
                <div class="input-group">
                    <label>üìÑ –ú–∞–∫—É–ª–∞—Ç—É—Ä–∞ (–∫–≥):</label>
                    <input type="number" id="paperWaste" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–≥" min="0">
                </div>
                <div class="input-group">
                    <label>ü•§ –ü–ª–∞—Å—Ç–∏–∫ (–∫–≥):</label>
                    <input type="number" id="plasticWaste" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–≥" min="0">
                </div>
                <div class="input-group">
                    <label>üç∂ –°—Ç–µ–∫–ª–æ (–∫–≥):</label>
                    <input type="number" id="glassWaste" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–≥" min="0">
                </div>
                <div class="input-group">
                    <label>üî© –ú–µ—Ç–∞–ª–ª (–∫–≥):</label>
                    <input type="number" id="metalWaste" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–≥" min="0">
                </div>
                <button onclick="calculateResourceSavings()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã</button>
            </div>

            <div id="batteriesRecycling" class="recycling-form">
                <div class="input-group">
                    <label>üîã –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ç–∞—Ä–µ–µ–∫ (—à—Ç):</label>
                    <input type="number" id="batteriesCount" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0">
                </div>
                <div class="battery-info">
                    <p>üí° 1 –±–∞—Ç–∞—Ä–µ–π–∫–∞ –∑–∞–≥—Ä—è–∑–Ω—è–µ—Ç 20 –º¬≤ –∑–µ–º–ª–∏ –∏ 400 –ª –≤–æ–¥—ã</p>
                </div>
                <button onclick="calculateBatteriesSavings()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç</button>
            </div>

            <div id="bottlesRecycling" class="recycling-form">
                <div class="input-group">
                    <label>ü•§ –ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ –±—É—Ç—ã–ª–∫–∏ (—à—Ç):</label>
                    <input type="number" id="plasticBottles" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0">
                </div>
                <div class="input-group">
                    <label>üç∂ –°—Ç–µ–∫–ª—è–Ω–Ω—ã–µ –±—É—Ç—ã–ª–∫–∏ (—à—Ç):</label>
                    <input type="number" id="glassBottles" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0">
                </div>
                <div class="input-group">
                    <label>ü•´ –ê–ª—é–º–∏–Ω–∏–µ–≤—ã–µ –±–∞–Ω–∫–∏ (—à—Ç):</label>
                    <input type="number" id="aluminumCans" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0">
                </div>
                <button onclick="calculateBottlesSavings()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —ç–∫–æ–Ω–æ–º–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤</button>
            </div>

            <div id="recyclingResult" class="result savings-result"></div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —É–≥–ª–µ—Ä–æ–¥–Ω–æ–≥–æ —Å–ª–µ–¥–∞ -->
        <section class="calculator">
            <h2>üåç –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —É–≥–ª–µ—Ä–æ–¥–Ω–æ–≥–æ —Å–ª–µ–¥–∞</h2>
            <div class="calc-form">
                <div class="input-group">
                    <label>üöó –ü—Ä–æ–±–µ–≥ –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ –≤ –º–µ—Å—è—Ü (–∫–º):</label>
                    <input type="number" id="carKm" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–∏–ª–æ–º–µ—Ç—Ä—ã">
                </div>
                <div class="input-group">
                    <label>üí° –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ –≤ –º–µ—Å—è—Ü (–∫–í—Ç¬∑—á):</label>
                    <input type="number" id="electricity" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–í—Ç¬∑—á">
                </div>
                <div class="input-group">
                    <label>‚úàÔ∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–ª–µ—Ç–æ–≤ –≤ –≥–æ–¥:</label>
                    <input type="number" id="flights" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–ª–µ—Ç–æ–≤">
                </div>
                <button onclick="calculateCarbonFootprint()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —É–≥–ª–µ—Ä–æ–¥–Ω—ã–π —Å–ª–µ–¥</button>
                <div id="carbonResult" class="result"></div>
            </div>
        </section>
    </main>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="app.js"></script>
    <script src="calculator.js"></script>
    <script src="historical-map.js"></script>
    <script>
    // –§–∏–Ω–∞–ª—å–Ω–∞—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è historical-map.js
    class HistoricalPollutionMap {
        constructor() {
            this.currentYear = 2024;
            this.currentDataType = 'air';
            this.currentMarkers = [];
            this.initMap();
        }

        initMap() {
            const mapContainer = document.getElementById('pollutionMap');
            if (!mapContainer) return;

            try {
                this.map = L.map('pollutionMap').setView([30, 0], 2);
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(this.map);

                this.setupEventListeners();
                this.loadDataForYear(this.currentYear);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã:', error);
            }
        }

        setupEventListeners() {
            const yearSlider = document.getElementById('yearSlider');
            const yearDisplay = document.getElementById('currentYearDisplay');
            
            if (yearSlider && yearDisplay) {
                yearSlider.addEventListener('input', (e) => {
                    this.currentYear = parseInt(e.target.value);
                    yearDisplay.textContent = this.currentYear;
                    this.loadDataForYear(this.currentYear);
                });
            }

            document.querySelectorAll('.data-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.data-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    this.currentDataType = e.target.dataset.type;
                    this.loadDataForYear(this.currentYear);
                });
            });
        }

        loadDataForYear(year) {
            const data = this.getMockData(year);
            this.renderDataOnMap(data);
            this.updateStats(data);
        }

        getMockData(year) {
            if (this.currentDataType === 'air') {
                return this.getMockAirData(year);
            } else {
                return this.getMockWaterData(year);
            }
        }

        getMockAirData(year) {
            const cities = [
                // –†–æ—Å—Å–∏—è (10 –≥–æ—Ä–æ–¥–æ–≤)
                { name: "–ú–æ—Å–∫–≤–∞", lat: 55.7558, lng: 37.6173, country: "–†–æ—Å—Å–∏—è" },
                { name: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", lat: 59.9343, lng: 30.3351, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", lat: 55.0084, lng: 82.9357, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", lat: 56.8389, lng: 60.6057, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ö–∞–∑–∞–Ω—å", lat: 55.7961, lng: 49.1064, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", lat: 56.3269, lng: 44.0065, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ß–µ–ª—è–±–∏–Ω—Å–∫", lat: 55.1644, lng: 61.4368, country: "–†–æ—Å—Å–∏—è" },
                { name: "–°–∞–º–∞—Ä–∞", lat: 53.1959, lng: 50.1002, country: "–†–æ—Å—Å–∏—è" },
                { name: "–û–º—Å–∫", lat: 54.9885, lng: 73.3242, country: "–†–æ—Å—Å–∏—è" },
                { name: "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É", lat: 47.2226, lng: 39.7187, country: "–†–æ—Å—Å–∏—è" },

                // –ï–≤—Ä–æ–ø–∞ (15 –≥–æ—Ä–æ–¥–æ–≤)
                { name: "–õ–æ–Ω–¥–æ–Ω", lat: 51.5074, lng: -0.1278, country: "–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è" },
                { name: "–ü–∞—Ä–∏–∂", lat: 48.8566, lng: 2.3522, country: "–§—Ä–∞–Ω—Ü–∏—è" },
                { name: "–ë–µ—Ä–ª–∏–Ω", lat: 52.5200, lng: 13.4050, country: "–ì–µ—Ä–º–∞–Ω–∏—è" },
                { name: "–ú–∞–¥—Ä–∏–¥", lat: 40.4168, lng: -3.7038, country: "–ò—Å–ø–∞–Ω–∏—è" },
                { name: "–†–∏–º", lat: 41.9028, lng: 12.4964, country: "–ò—Ç–∞–ª–∏—è" },
                { name: "–ö–∏–µ–≤", lat: 50.4501, lng: 30.5234, country: "–£–∫—Ä–∞–∏–Ω–∞" },
                { name: "–í–∞—Ä—à–∞–≤–∞", lat: 52.2297, lng: 21.0122, country: "–ü–æ–ª—å—à–∞" },
                { name: "–ü—Ä–∞–≥–∞", lat: 50.0755, lng: 14.4378, country: "–ß–µ—Ö–∏—è" },
                { name: "–ë—É–¥–∞–ø–µ—à—Ç", lat: 47.4979, lng: 19.0402, country: "–í–µ–Ω–≥—Ä–∏—è" },
                { name: "–í–µ–Ω–∞", lat: 48.2082, lng: 16.3738, country: "–ê–≤—Å—Ç—Ä–∏—è" },
                { name: "–ê–º—Å—Ç–µ—Ä–¥–∞–º", lat: 52.3676, lng: 4.9041, country: "–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã" },
                { name: "–ë—Ä—é—Å—Å–µ–ª—å", lat: 50.8503, lng: 4.3517, country: "–ë–µ–ª—å–≥–∏—è" },
                { name: "–°—Ç–æ–∫–≥–æ–ª—å–º", lat: 59.3293, lng: 18.0686, country: "–®–≤–µ—Ü–∏—è" },
                { name: "–û—Å–ª–æ", lat: 59.9139, lng: 10.7522, country: "–ù–æ—Ä–≤–µ–≥–∏—è" },
                { name: "–•–µ–ª—å—Å–∏–Ω–∫–∏", lat: 60.1699, lng: 24.9384, country: "–§–∏–Ω–ª—è–Ω–¥–∏—è" },

                // –ê–∑–∏—è (15 –≥–æ—Ä–æ–¥–æ–≤)
                { name: "–ü–µ–∫–∏–Ω", lat: 39.9042, lng: 116.4074, country: "–ö–∏—Ç–∞–π" },
                { name: "–¢–æ–∫–∏–æ", lat: 35.6762, lng: 139.6503, country: "–Ø–ø–æ–Ω–∏—è" },
                { name: "–°–µ—É–ª", lat: 37.5665, lng: 126.9780, country: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è" },
                { name: "–î–µ–ª–∏", lat: 28.6139, lng: 77.2090, country: "–ò–Ω–¥–∏—è" },
                { name: "–ú—É–º–±–∞–∏", lat: 19.0760, lng: 72.8777, country: "–ò–Ω–¥–∏—è" },
                { name: "–ë–∞–Ω–≥–∫–æ–∫", lat: 13.7563, lng: 100.5018, country: "–¢–∞–∏–ª–∞–Ω–¥" },
                { name: "–°–∏–Ω–≥–∞–ø—É—Ä", lat: 1.3521, lng: 103.8198, country: "–°–∏–Ω–≥–∞–ø—É—Ä" },
                { name: "–î–∂–∞–∫–∞—Ä—Ç–∞", lat: -6.2088, lng: 106.8456, country: "–ò–Ω–¥–æ–Ω–µ–∑–∏—è" },
                { name: "–ú–∞–Ω–∏–ª–∞", lat: 14.5995, lng: 120.9842, country: "–§–∏–ª–∏–ø–ø–∏–Ω—ã" },
                { name: "–ö—É–∞–ª–∞-–õ—É–º–ø—É—Ä", lat: 3.1390, lng: 101.6869, country: "–ú–∞–ª–∞–π–∑–∏—è" },
                { name: "–î—É–±–∞–π", lat: 25.2048, lng: 55.2708, country: "–û–ê–≠" },
                { name: "–¢–µ–≥–µ—Ä–∞–Ω", lat: 35.6892, lng: 51.3890, country: "–ò—Ä–∞–Ω" },
                { name: "–ë–∞–≥–¥–∞–¥", lat: 33.3152, lng: 44.3661, country: "–ò—Ä–∞–∫" },
                { name: "–≠—Ä-–†–∏—è–¥", lat: 24.7136, lng: 46.6753, country: "–°–∞—É–¥–æ–≤—Å–∫–∞—è –ê—Ä–∞–≤–∏—è" },
                { name: "–ê–Ω–∫–∞—Ä–∞", lat: 39.9334, lng: 32.8597, country: "–¢—É—Ä—Ü–∏—è" },

                // –°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞ (10 –≥–æ—Ä–æ–¥–æ–≤)
                { name: "–ù—å—é-–ô–æ—Ä–∫", lat: 40.7128, lng: -74.0060, country: "–°–®–ê" },
                { name: "–õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å", lat: 34.0522, lng: -118.2437, country: "–°–®–ê" },
                { name: "–ß–∏–∫–∞–≥–æ", lat: 41.8781, lng: -87.6298, country: "–°–®–ê" },
                { name: "–¢–æ—Ä–æ–Ω—Ç–æ", lat: 43.6532, lng: -79.3832, country: "–ö–∞–Ω–∞–¥–∞" },
                { name: "–ú–µ—Ö–∏–∫–æ", lat: 19.4326, lng: -99.1332, country: "–ú–µ–∫—Å–∏–∫–∞" },
                { name: "–ú–∞–π–∞–º–∏", lat: 25.7617, lng: -80.1918, country: "–°–®–ê" },
                { name: "–í–∞–Ω–∫—É–≤–µ—Ä", lat: 49.2827, lng: -123.1207, country: "–ö–∞–Ω–∞–¥–∞" },
                { name: "–í–∞—à–∏–Ω–≥—Ç–æ–Ω", lat: 38.9072, lng: -77.0369, country: "–°–®–ê" },
                { name: "–ë–æ—Å—Ç–æ–Ω", lat: 42.3601, lng: -71.0589, country: "–°–®–ê" },
                { name: "–°–∞–Ω-–§—Ä–∞–Ω—Ü–∏—Å–∫–æ", lat: 37.7749, lng: -122.4194, country: "–°–®–ê" },

                // –Æ–∂–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞ (10 –≥–æ—Ä–æ–¥–æ–≤)
                { name: "–°–∞–Ω-–ü–∞—É–ª—É", lat: -23.5505, lng: -46.6333, country: "–ë—Ä–∞–∑–∏–ª–∏—è" },
                { name: "–ë—É—ç–Ω–æ—Å-–ê–π—Ä–µ—Å", lat: -34.6037, lng: -58.3816, country: "–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞" },
                { name: "–õ–∏–º–∞", lat: -12.0464, lng: -77.0428, country: "–ü–µ—Ä—É" },
                { name: "–ë–æ–≥–æ—Ç–∞", lat: 4.7110, lng: -74.0721, country: "–ö–æ–ª—É–º–±–∏—è" },
                { name: "–†–∏–æ-–¥–µ-–ñ–∞–Ω–µ–π—Ä–æ", lat: -22.9068, lng: -43.1729, country: "–ë—Ä–∞–∑–∏–ª–∏—è" },
                { name: "–°–∞–Ω—Ç—å—è–≥–æ", lat: -33.4489, lng: -70.6693, country: "–ß–∏–ª–∏" },
                { name: "–ö–∞—Ä–∞–∫–∞—Å", lat: 10.4806, lng: -66.9036, country: "–í–µ–Ω–µ—Å—É—ç–ª–∞" },
                { name: "–ö–∏—Ç–æ", lat: -0.1807, lng: -78.4678, country: "–≠–∫–≤–∞–¥–æ—Ä" },
                { name: "–ú–æ–Ω—Ç–µ–≤–∏–¥–µ–æ", lat: -34.9011, lng: -56.1645, country: "–£—Ä—É–≥–≤–∞–π" },
                { name: "–õ–∞-–ü–∞—Å", lat: -16.4897, lng: -68.1193, country: "–ë–æ–ª–∏–≤–∏—è" },

                // –ê—Ñ—Ä–∏–∫–∞ (10 –≥–æ—Ä–æ–¥–æ–≤)
                { name: "–ö–∞–∏—Ä", lat: 30.0444, lng: 31.2357, country: "–ï–≥–∏–ø–µ—Ç" },
                { name: "–õ–∞–≥–æ—Å", lat: 6.5244, lng: 3.3792, country: "–ù–∏–≥–µ—Ä–∏—è" },
                { name: "–ô–æ—Ö–∞–Ω–Ω–µ—Å–±—É—Ä–≥", lat: -26.2041, lng: 28.0473, country: "–Æ–ê–†" },
                { name: "–ù–∞–π—Ä–æ–±–∏", lat: -1.2864, lng: 36.8172, country: "–ö–µ–Ω–∏—è" },
                { name: "–ö–µ–π–ø—Ç–∞—É–Ω", lat: -33.9249, lng: 18.4241, country: "–Æ–ê–†" },
                { name: "–ê–∫–∫—Ä–∞", lat: 5.6037, lng: -0.1870, country: "–ì–∞–Ω–∞" },
                { name: "–ê–¥–∏—Å-–ê–±–µ–±–∞", lat: 9.0300, lng: 38.7400, country: "–≠—Ñ–∏–æ–ø–∏—è" },
                { name: "–î–∞—Ä-—ç—Å-–°–∞–ª–∞–º", lat: -6.7924, lng: 39.2083, country: "–¢–∞–Ω–∑–∞–Ω–∏—è" },
                { name: "–ê–ª–∂–∏—Ä", lat: 36.7538, lng: 3.0588, country: "–ê–ª–∂–∏—Ä" },
                { name: "–ö–∞—Å–∞–±–ª–∞–Ω–∫–∞", lat: 33.5731, lng: -7.5898, country: "–ú–∞—Ä–æ–∫–∫–æ" },

                // –ê–≤—Å—Ç—Ä–∞–ª–∏—è –∏ –û–∫–µ–∞–Ω–∏—è (5 –≥–æ—Ä–æ–¥–æ–≤)
                { name: "–°–∏–¥–Ω–µ–π", lat: -33.8688, lng: 151.2093, country: "–ê–≤—Å—Ç—Ä–∞–ª–∏—è" },
                { name: "–ú–µ–ª—å–±—É—Ä–Ω", lat: -37.8136, lng: 144.9631, country: "–ê–≤—Å—Ç—Ä–∞–ª–∏—è" },
                { name: "–ë—Ä–∏—Å–±–µ–Ω", lat: -27.4698, lng: 153.0251, country: "–ê–≤—Å—Ç—Ä–∞–ª–∏—è" },
                { name: "–ü–µ—Ä—Ç", lat: -31.9505, lng: 115.8605, country: "–ê–≤—Å—Ç—Ä–∞–ª–∏—è" },
                { name: "–û–∫–ª–µ–Ω–¥", lat: -36.8485, lng: 174.7633, country: "–ù–æ–≤–∞—è –ó–µ–ª–∞–Ω–¥–∏—è" }
            ];

            const data = cities.map(city => {
                const yearFactor = (year - 1800) / (2024 - 1800);
                const basePM25 = 5 + yearFactor * 45;
                const randomFactor = 0.7 + Math.random() * 0.6;
                const pm25 = Math.round(basePM25 * randomFactor);
                
                return {
                    coordinates: { latitude: city.lat, longitude: city.lng },
                    location: city.name,
                    city: city.name,
                    country: city.country,
                    measurements: [
                        { parameter: 'pm25', value: pm25 },
                        { parameter: 'so2', value: Math.round(10 + yearFactor * 50) },
                        { parameter: 'no2', value: Math.round(8 + yearFactor * 42) }
                    ]
                };
            });
            
            return {
                data: data,
                globalParameters: {
                    co2: 280 + Math.round((year - 1800) * 0.67),
                    so2: 5 + Math.round((year - 1800) * 0.23),
                    no2: 3 + Math.round((year - 1800) * 0.19)
                }
            };
        }

        getMockWaterData(year) {
            const waterPoints = [
                // –†–µ–∫–∏ –†–æ—Å—Å–∏–∏ (15)
                { name: "–í–æ–ª–≥–∞", lat: 56.1309, lng: 44.0002, country: "–†–æ—Å—Å–∏—è" },
                { name: "–û–±—å", lat: 55.0113, lng: 82.9346, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ï–Ω–∏—Å–µ–π", lat: 69.4000, lng: 86.1667, country: "–†–æ—Å—Å–∏—è" },
                { name: "–õ–µ–Ω–∞", lat: 72.3667, lng: 126.7667, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ê–º—É—Ä", lat: 52.9667, lng: 141.0333, country: "–†–æ—Å—Å–∏—è" },
                { name: "–î–æ–Ω", lat: 47.2226, lng: 39.7187, country: "–†–æ—Å—Å–∏—è" },
                { name: "–î–Ω–µ–ø—Ä", lat: 46.5167, lng: 30.7333, country: "–†–æ—Å—Å–∏—è/–£–∫—Ä–∞–∏–Ω–∞" },
                { name: "–ù–µ–≤–∞", lat: 59.9398, lng: 30.3146, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ö–∞–º–∞", lat: 55.7961, lng: 52.0245, country: "–†–æ—Å—Å–∏—è" },
                { name: "–°–µ–≤–µ—Ä–Ω–∞—è –î–≤–∏–Ω–∞", lat: 64.5401, lng: 40.5134, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ü–µ—á–æ—Ä–∞", lat: 65.1333, lng: 57.1167, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ö–æ–ª—ã–º–∞", lat: 69.7000, lng: 161.4000, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ê–Ω–≥–∞—Ä–∞", lat: 58.1000, lng: 92.9833, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ò—Ä—Ç—ã—à", lat: 61.0833, lng: 68.8333, country: "–†–æ—Å—Å–∏—è" },
                { name: "–£—Ä–∞–ª", lat: 51.2167, lng: 58.1667, country: "–†–æ—Å—Å–∏—è" },

                // –û–∑–µ—Ä–∞ –†–æ—Å—Å–∏–∏ (10)
                { name: "–ë–∞–π–∫–∞–ª", lat: 53.5000, lng: 108.0000, country: "–†–æ—Å—Å–∏—è" },
                { name: "–õ–∞–¥–æ–∂—Å–∫–æ–µ", lat: 61.0000, lng: 31.5000, country: "–†–æ—Å—Å–∏—è" },
                { name: "–û–Ω–µ–∂—Å–∫–æ–µ", lat: 61.5000, lng: 35.5000, country: "–†–æ—Å—Å–∏—è" },
                { name: "–¢–∞–π–º—ã—Ä", lat: 74.5333, lng: 101.6167, country: "–†–æ—Å—Å–∏—è" },
                { name: "–•–∞–Ω–∫–∞", lat: 45.0000, lng: 132.4167, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ß—É–¥—Å–∫–æ–µ", lat: 58.6667, lng: 27.5000, country: "–†–æ—Å—Å–∏—è/–≠—Å—Ç–æ–Ω–∏—è" },
                { name: "–ë–µ–ª–æ–µ", lat: 60.1667, lng: 37.6333, country: "–†–æ—Å—Å–∏—è" },
                { name: "–¢–æ–ø–æ–∑–µ—Ä–æ", lat: 65.6333, lng: 32.0833, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ò–ª—å–º–µ–Ω—å", lat: 58.2667, lng: 31.2833, country: "–†–æ—Å—Å–∏—è" },
                { name: "–ò–º–∞–Ω–¥—Ä–∞", lat: 67.5833, lng: 33.0000, country: "–†–æ—Å—Å–∏—è" },

                // –ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ —Ä–µ–∫–∏ (15)
                { name: "–î—É–Ω–∞–π", lat: 45.2539, lng: 29.6581, country: "–ï–≤—Ä–æ–ø–∞" },
                { name: "–†–µ–π–Ω", lat: 51.9653, lng: 7.6213, country: "–ì–µ—Ä–º–∞–Ω–∏—è" },
                { name: "–°–µ–Ω–∞", lat: 49.4333, lng: 1.0833, country: "–§—Ä–∞–Ω—Ü–∏—è" },
                { name: "–¢–µ–º–∑–∞", lat: 51.4947, lng: -0.1083, country: "–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è" },
                { name: "–≠–ª—å–±–∞", lat: 53.5333, lng: 9.9833, country: "–ì–µ—Ä–º–∞–Ω–∏—è" },
                { name: "–ü–æ", lat: 44.9667, lng: 12.4333, country: "–ò—Ç–∞–ª–∏—è" },
                { name: "–í–∏—Å–ª–∞", lat: 54.3667, lng: 18.6667, country: "–ü–æ–ª—å—à–∞" },
                { name: "–õ—É–∞—Ä–∞", lat: 47.2667, lng: -2.1667, country: "–§—Ä–∞–Ω—Ü–∏—è" },
                { name: "–ì–≤–∞–¥–∞–ª–∫–≤–∏–≤–∏—Ä", lat: 36.7833, lng: -6.3500, country: "–ò—Å–ø–∞–Ω–∏—è" },
                { name: "–¢–∞—Ö–æ", lat: 38.8667, lng: -9.0000, country: "–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è" },
                { name: "–û–¥–µ—Ä", lat: 53.5833, lng: 14.5833, country: "–ì–µ—Ä–º–∞–Ω–∏—è" },
                { name: "–®–µ–ª—å–¥–∞", lat: 51.4333, lng: 4.1000, country: "–ë–µ–ª—å–≥–∏—è" },
                { name: "–ú–∞–π–Ω", lat: 50.0000, lng: 8.2833, country: "–ì–µ—Ä–º–∞–Ω–∏—è" },
                { name: "–ú–æ–∑–µ–ª—å", lat: 50.3667, lng: 7.6000, country: "–ì–µ—Ä–º–∞–Ω–∏—è" },
                { name: "–î—É—ç—Ä–æ", lat: 41.1500, lng: -8.6667, country: "–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è" },

                // –ê–∑–∏–∞—Ç—Å–∫–∏–µ —Ä–µ–∫–∏ (15)
                { name: "–Ø–Ω—Ü–∑—ã", lat: 31.7833, lng: 121.9667, country: "–ö–∏—Ç–∞–π" },
                { name: "–•—É–∞–Ω—Ö—ç", lat: 37.5667, lng: 118.5333, country: "–ö–∏—Ç–∞–π" },
                { name: "–ì–∞–Ω–≥", lat: 22.5833, lng: 88.3667, country: "–ò–Ω–¥–∏—è" },
                { name: "–ò–Ω–¥", lat: 24.9167, lng: 67.0833, country: "–ü–∞–∫–∏—Å—Ç–∞–Ω" },
                { name: "–ú–µ–∫–æ–Ω–≥", lat: 10.0333, lng: 105.7833, country: "–í—å–µ—Ç–Ω–∞–º" },
                { name: "–¢–∏–≥—Ä", lat: 31.0000, lng: 47.4333, country: "–ò—Ä–∞–∫" },
                { name: "–ï–≤—Ñ—Ä–∞—Ç", lat: 31.0000, lng: 47.4333, country: "–ò—Ä–∞–∫" },
                { name: "–ë—Ä–∞—Ö–º–∞–ø—É—Ç—Ä–∞", lat: 25.2000, lng: 89.7667, country: "–ë–∞–Ω–≥–ª–∞–¥–µ—à" },
                { name: "–ò—Ä–∞–≤–∞–¥–∏", lat: 16.5000, lng: 96.3333, country: "–ú—å—è–Ω–º–∞" },
                { name: "–°–∞–ª—É–∏–Ω", lat: 16.5000, lng: 97.6000, country: "–ú—å—è–Ω–º–∞" },
                { name: "–ß–∞—É–ø—Ö—Ä–∞—è", lat: 13.5333, lng: 100.5833, country: "–¢–∞–∏–ª–∞–Ω–¥" },
                { name: "–°—ã—Ä–¥–∞—Ä—å—è", lat: 46.9667, lng: 61.0333, country: "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω" },
                { name: "–ê–º—É–¥–∞—Ä—å—è", lat: 43.6667, lng: 59.8500, country: "–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω" },
                { name: "–•–∞—Ç–∞–Ω–≥–∞", lat: 71.8833, lng: 102.1000, country: "–†–æ—Å—Å–∏—è" },
                { name: "–Ø–Ω–∞", lat: 71.5333, lng: 136.6667, country: "–†–æ—Å—Å–∏—è" },

                // –°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞ (10)
                { name: "–ú–∏—Å—Å–∏—Å–∏–ø–∏", lat: 29.9500, lng: -90.0667, country: "–°–®–ê" },
                { name: "–ú–∏—Å—Å—É—Ä–∏", lat: 38.8167, lng: -90.1500, country: "–°–®–ê" },
                { name: "–ö–æ–ª–æ—Ä–∞–¥–æ", lat: 31.7833, lng: -114.7833, country: "–°–®–ê" },
                { name: "–†–∏–æ-–ì—Ä–∞–Ω–¥–µ", lat: 25.9333, lng: -97.1500, country: "–°–®–ê/–ú–µ–∫—Å–∏–∫–∞" },
                { name: "–Æ–∫–æ–Ω", lat: 62.5833, lng: -164.8000, country: "–ö–∞–Ω–∞–¥–∞/–°–®–ê" },
                { name: "–ú–∞–∫–∫–µ–Ω–∑–∏", lat: 69.3333, lng: -133.9000, country: "–ö–∞–Ω–∞–¥–∞" },
                { name: "–°–≤—è—Ç–æ–≥–æ –õ–∞–≤—Ä–µ–Ω—Ç–∏—è", lat: 49.0000, lng: -64.8000, country: "–ö–∞–Ω–∞–¥–∞" },
                { name: "–ö–æ–ª—É–º–±–∏—è", lat: 46.2500, lng: -124.0500, country: "–°–®–ê" },
                { name: "–°–Ω–µ–π–∫", lat: 46.1833, lng: -119.0167, country: "–°–®–ê" },
                { name: "–û–≥–∞–π–æ", lat: 36.9833, lng: -89.1333, country: "–°–®–ê" },

                // –Æ–∂–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞ (5)
                { name: "–ê–º–∞–∑–æ–Ω–∫–∞", lat: -0.1667, lng: -49.0000, country: "–ë—Ä–∞–∑–∏–ª–∏—è" },
                { name: "–ü–∞—Ä–∞–Ω–∞", lat: -33.9167, lng: -58.4167, country: "–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞" },
                { name: "–û—Ä–∏–Ω–æ–∫–æ", lat: 8.3333, lng: -62.6667, country: "–í–µ–Ω–µ—Å—É—ç–ª–∞" },
                { name: "–°–∞–Ω-–§—Ä–∞–Ω—Å–∏—Å–∫—É", lat: -10.5000, lng: -36.4000, country: "–ë—Ä–∞–∑–∏–ª–∏—è" },
                { name: "–ú–∞–≥–¥–∞–ª–µ–Ω–∞", lat: 11.1000, lng: -74.8500, country: "–ö–æ–ª—É–º–±–∏—è" }
            ];
            
            const data = waterPoints.map(point => {
                const yearFactor = (year - 1800) / (2024 - 1800);
                const basePollution = 5 + yearFactor * 30;
                const randomFactor = 0.8 + Math.random() * 0.4;
                const pollution = basePollution * randomFactor;
                
                return {
                    coordinates: { latitude: point.lat, longitude: point.lng },
                    location: point.name,
                    city: point.name,
                    country: point.country,
                    measurements: [
                        { parameter: 'pollution', value: pollution },
                        { parameter: 'ph', value: 6.5 + Math.random() * 1.5 },
                        { parameter: 'oxygen', value: 70 + Math.random() * 25 }
                    ],
                    pollution: pollution
                };
            });
            
            return {
                data: data,
                globalParameters: {
                    averagePollution: data.reduce((sum, point) => sum + point.pollution, 0) / data.length,
                    totalStations: data.length
                }
            };
        }

        renderDataOnMap(data) {
            this.clearMarkers();
            
            if (this.currentDataType === 'air') {
                this.renderAirQuality(data);
            } else {
                this.renderWaterQuality(data);
            }
        }

        clearMarkers() {
            if (this.currentMarkers && this.currentMarkers.length > 0) {
                this.currentMarkers.forEach(marker => {
                    if (marker && this.map.hasLayer(marker)) {
                        this.map.removeLayer(marker);
                    }
                });
                this.currentMarkers = [];
            }
        }

        renderAirQuality(airData) {
            if (!airData.data || !Array.isArray(airData.data)) return;

            airData.data.forEach(station => {
                if (!station.coordinates) return;

                const pm25Value = station.measurements.find(m => m.parameter === 'pm25')?.value || 0;
                const quality = this.getAirQualityByValue(pm25Value);

                const marker = L.circleMarker([station.coordinates.latitude, station.coordinates.longitude], {
                    radius: 6,
                    fillColor: this.getAirQualityColor(quality),
                    color: '#000',
                    weight: 1,
                    opacity: 0.8,
                    fillOpacity: 0.7
                }).addTo(this.map);

                marker.bindPopup(`
                    <div style="min-width: 200px;">
                        <strong>${station.location}</strong><br>
                        <strong>–°—Ç—Ä–∞–Ω–∞:</strong> ${station.country}<br>
                        <strong>–ì–æ–¥:</strong> ${this.currentYear}<br>
                        <strong>PM2.5:</strong> ${pm25Value} ¬µg/m¬≥<br>
                        <strong>–ö–∞—á–µ—Å—Ç–≤–æ:</strong> ${this.getAirQualityText(quality)}
                    </div>
                `);

                this.currentMarkers.push(marker);
            });
        }

        renderWaterQuality(waterData) {
            if (!waterData.data || !Array.isArray(waterData.data)) return;

            waterData.data.forEach(point => {
                if (!point.coordinates) return;

                const pollutionValue = point.pollution || point.measurements?.find(m => m.parameter === 'pollution')?.value || 0;
                const marker = L.circleMarker([point.coordinates.latitude, point.coordinates.longitude], {
                    radius: 6,
                    fillColor: this.getWaterQualityColor(pollutionValue),
                    color: '#000',
                    weight: 1,
                    opacity: 0.8,
                    fillOpacity: 0.7
                }).addTo(this.map);

                marker.bindPopup(`
                    <div style="min-width: 200px;">
                        <strong>${point.location}</strong><br>
                        <strong>–°—Ç—Ä–∞–Ω–∞:</strong> ${point.country}<br>
                        <strong>–ì–æ–¥:</strong> ${this.currentYear}<br>
                        <strong>–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ:</strong> ${pollutionValue.toFixed(1)}%<br>
                        <strong>–ö–∞—á–µ—Å—Ç–≤–æ:</strong> ${this.getWaterQualityText(pollutionValue)}
                    </div>
                `);

                this.currentMarkers.push(marker);
            });
        }

        getAirQualityByValue(pm25) {
            if (pm25 <= 12) return 'excellent';
            if (pm25 <= 35) return 'good';
            if (pm25 <= 55) return 'moderate';
            if (pm25 <= 150) return 'poor';
            return 'very-poor';
        }

        getAirQualityColor(quality) {
            const colors = {
                'excellent': '#00e400',
                'good': '#ffff00',
                'moderate': '#ff7e00',
                'poor': '#ff0000',
                'very-poor': '#8f3f97'
            };
            return colors[quality] || '#cccccc';
        }

        getWaterQualityColor(pollution) {
            if (pollution < 20) return '#1e90ff';
            if (pollution < 40) return '#00ced1';
            if (pollution < 60) return '#ffa500';
            return '#ff4500';
        }

        getAirQualityText(quality) {
            const texts = {
                'excellent': '–û—Ç–ª–∏—á–Ω–æ–µ',
                'good': '–•–æ—Ä–æ—à–µ–µ',
                'moderate': '–£–º–µ—Ä–µ–Ω–Ω–æ–µ',
                'poor': '–ü–ª–æ—Ö–æ–µ',
                'very-poor': '–û—á–µ–Ω—å –ø–ª–æ—Ö–æ–µ'
            };
            return texts[quality] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        }

        getWaterQualityText(pollution) {
            if (pollution < 20) return '–û—Ç–ª–∏—á–Ω–æ–µ';
            if (pollution < 40) return '–•–æ—Ä–æ—à–µ–µ';
            if (pollution < 60) return '–£–º–µ—Ä–µ–Ω–Ω–æ–µ';
            return '–ü–ª–æ—Ö–æ–µ';
        }

        updateStats(data) {
            const statsYear = document.getElementById('statsYear');
            if (statsYear) {
                statsYear.textContent = this.currentYear;
            }

            if (this.currentDataType === 'air') {
                this.updateAirStats(data);
            } else {
                this.updateWaterStats(data);
            }

            this.toggleStatsVisibility();
        }

        updateAirStats(airData) {
            const co2Value = document.getElementById('co2Value');
            const so2Value = document.getElementById('so2Value');
            const no2Value = document.getElementById('no2Value');

            if (airData.globalParameters) {
                if (co2Value) co2Value.textContent = airData.globalParameters.co2;
                if (so2Value) so2Value.textContent = airData.globalParameters.so2;
                if (no2Value) no2Value.textContent = airData.globalParameters.no2;
            }
        }

        updateWaterStats(waterData) {
            const waterStationsCount = document.getElementById('waterStationsCount');
            const avgWaterPollution = document.getElementById('avgWaterPollution');

            if (waterData.data && Array.isArray(waterData.data)) {
                const totalPollution = waterData.data.reduce((sum, point) => {
                    const pollution = point.pollution || point.measurements?.find(m => m.parameter === 'pollution')?.value || 0;
                    return sum + pollution;
                }, 0);
                const averagePollution = totalPollution / waterData.data.length;

                if (waterStationsCount) waterStationsCount.textContent = waterData.data.length;
                if (avgWaterPollution) avgWaterPollution.textContent = averagePollution.toFixed(1);
            } else {
                if (waterStationsCount) waterStationsCount.textContent = '0';
                if (avgWaterPollution) avgWaterPollution.textContent = '0';
            }
        }

        toggleStatsVisibility() {
            const airStats = document.getElementById('airStats');
            const waterStats = document.getElementById('waterStats');
            const airLegend = document.getElementById('airLegend');
            const waterLegend = document.getElementById('waterLegend');

            if (this.currentDataType === 'air') {
                if (airStats) airStats.style.display = 'block';
                if (waterStats) waterStats.style.display = 'none';
                if (airLegend) airLegend.style.display = 'block';
                if (waterLegend) waterLegend.style.display = 'none';
            } else {
                if (airStats) airStats.style.display = 'none';
                if (waterStats) waterStats.style.display = 'block';
                if (airLegend) airLegend.style.display = 'none';
                if (waterLegend) waterLegend.style.display = 'block';
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        if (document.getElementById('pollutionMap')) {
            try {
                window.historicalMap = new HistoricalPollutionMap();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π –∫–∞—Ä—Ç—ã:', error);
            }
        }
    });
</script>
    <script>
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded');
    console.log('Map element:', document.getElementById('map'));
    console.log('Historical map:', document.getElementById('pollutionMap'));
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π
    console.log('calculateCarbonFootprint:', typeof calculateCarbonFootprint);
    console.log('showTab:', typeof showTab);
    console.log('HistoricalPollutionMap:', typeof HistoricalPollutionMap);
});
</script>
    
</body>
</html>
