<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–∫–æ-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <header>
        <h1>üåç –≠–∫–æ-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</h1>
        <p>–†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã</p>
    </header>

    <main>
        <section class="stats">
            <div class="stat-card">
                <h3>üíß –ü–∏—Ç—å–µ–≤–∞—è –≤–æ–¥–∞</h3>
                <div class="counter">2.5%</div>
                <p>–ø—Ä–µ—Å–Ω–æ–π –≤–æ–¥—ã –æ—Å—Ç–∞–ª–æ—Å—å</p>
            </div>
            <div class="stat-card">
                <h3>üî• –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∂–∞—Ä—ã</h3>
                <div id="fireCounter" class="counter">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <p>–æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å–ø—É—Ç–Ω–∏–∫–∞–º–∏</p>
            </div>
            <div class="stat-card">
                <h3>üå´Ô∏è –ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞</h3>
                <div id="airQuality" class="counter">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <p>—Å—Ç–∞–Ω—Ü–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</p>
            </div>
        </section>

        <section class="map-section">
            <h2>–ö–∞—Ä—Ç–∞ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h2>
            <div class="map-tabs">
                <button class="tab-btn active" onclick="showTab('air')">–ö–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞</button>
                <button class="tab-btn" onclick="showTab('fires')">–õ–µ—Å–Ω—ã–µ –ø–æ–∂–∞—Ä—ã</button>
            </div>
            <div id="map"></div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è -->
        <section id="historical-pollution" class="historical-section">
            <h2>üìä –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ (1800-2024)</h2>
            <div class="historical-controls">
                <div class="time-controls">
                    <label>–ì–æ–¥: <span id="currentYearDisplay">2024</span></label>
                    <input type="range" id="yearSlider" min="1800" max="2024" value="2024" class="timeline-slider">
                </div>
                <div class="data-type-buttons">
                    <button class="data-btn active" data-type="air">üå§Ô∏è –í–æ–∑–¥—É—Ö</button>
                    <button class="data-btn" data-type="water">üåä –í–æ–¥–∞</button>
                </div>
            </div>
            <div id="pollutionMap" style="height: 500px; margin: 20px 0; border-radius: 10px;"></div>
            <div class="pollution-info">
                <div id="pollutionStats" class="stats-card">
                    <h4>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ <span id="statsYear">2024</span> –≥–æ–¥</h4>
                    <div id="airStats" class="stats-content">
                        <p>CO‚ÇÇ: <span id="co2Value">420</span> ppm</p>
                        <p>SO‚ÇÇ: <span id="so2Value">60</span> ¬µg/m¬≥</p>
                        <p>NO‚ÇÇ: <span id="no2Value">50</span> ¬µg/m¬≥</p>
                    </div>
                    <div id="waterStats" class="stats-content" style="display: none;">
                        <p>–°—Ç–∞–Ω—Ü–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: <span id="waterStationsCount">70</span></p>
                        <p>–°—Ä–µ–¥–Ω–µ–µ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ: <span id="avgWaterPollution">35</span>%</p>
                    </div>
                </div>
                <div class="legend">
                    <h4>–õ–µ–≥–µ–Ω–¥–∞</h4>
                    <div id="airLegend">
                        <div class="legend-item">
                            <span class="color-box air-excellent"></span>
                            <span>–û—Ç–ª–∏—á–Ω–æ–µ (0-12 ¬µg/m¬≥)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box air-good"></span>
                            <span>–•–æ—Ä–æ—à–µ–µ (12-35 ¬µg/m¬≥)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box air-moderate"></span>
                            <span>–£–º–µ—Ä–µ–Ω–Ω–æ–µ (35-55 ¬µg/m¬≥)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box air-poor"></span>
                            <span>–ü–ª–æ—Ö–æ–µ (55-150 ¬µg/m¬≥)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box air-very-poor"></span>
                            <span>–û—á–µ–Ω—å –ø–ª–æ—Ö–æ–µ (150+ ¬µg/m¬≥)</span>
                        </div>
                    </div>
                    <div id="waterLegend" style="display: none;">
                        <div class="legend-item">
                            <span class="color-box water-clean"></span>
                            <span>–ß–∏—Å—Ç–∞—è (0-20%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box water-moderate"></span>
                            <span>–£–º–µ—Ä–µ–Ω–Ω–∞—è (20-40%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box water-polluted"></span>
                            <span>–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–Ω–∞—è (40-60%)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-box water-heavy-polluted"></span>
                            <span>–°–∏–ª—å–Ω–æ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–Ω–∞—è (60%+)</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è -->
        <section class="pollution-impact">
            <h2>üíî –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã</h2>
            <div class="impact-stats">
                <div class="impact-card">
                    <h3>üêæ –ü–æ–≥–∏–±—à–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ</h3>
                    <div class="counter" id="animalDeaths">1.5 –º–ª–Ω</div>
                    <p>–≤ –≥–æ–¥ –∏–∑-–∑–∞ –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã</p>
                    <div class="impact-details">
                        <p>‚Ä¢ 1 –º–ª–Ω –º–æ—Ä—Å–∫–∏—Ö –ø—Ç–∏—Ü</p>
                        <p>‚Ä¢ 100 —Ç—ã—Å –º–æ—Ä—Å–∫–∏—Ö –º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–∏—Ö</p>
                        <p>‚Ä¢ 400 —Ç—ã—Å –¥—Ä—É–≥–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö</p>
                    </div>
                </div>
                <div class="impact-card">
                    <h3>üë• –ü–æ–≥–∏–±—à–∏–µ –ª—é–¥–∏</h3>
                    <div class="counter" id="humanDeaths">9 –º–ª–Ω</div>
                    <p>–≤ –≥–æ–¥ –æ—Ç –±–æ–ª–µ–∑–Ω–µ–π, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ–º</p>
                    <div class="impact-details">
                        <p>‚Ä¢ 4.2 –º–ª–Ω –æ—Ç –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –≤–æ–∑–¥—É—Ö–∞</p>
                        <p>‚Ä¢ 2.2 –º–ª–Ω –æ—Ç –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏—è –≤–æ–¥—ã</p>
                        <p>‚Ä¢ 2.6 –º–ª–Ω –æ—Ç –¥—Ä—É–≥–∏—Ö –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ -->
        <section class="recycling-calculator">
            <h2>üå± –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤</h2>
            <div class="calc-tabs">
                <button class="calc-tab active" onclick="showRecyclingTab('general', event)">‚ôªÔ∏è –û–±—â–∏–π —Ä–∞—Å—á–µ—Ç</button>
                <button class="calc-tab" onclick="showRecyclingTab('batteries', event)">üîã –ë–∞—Ç–∞—Ä–µ–π–∫–∏</button>
                <button class="calc-tab" onclick="showRecyclingTab('bottles', event)">ü•§ –ë—É—Ç—ã–ª–∫–∏</button>
            </div>

            <div id="generalRecycling" class="recycling-form active">
                <div class="input-group">
                    <label>üìÑ –ú–∞–∫—É–ª–∞—Ç—É—Ä–∞ (–∫–≥):</label>
                    <input type="number" id="paperWaste" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–≥" min="0">
                </div>
                <div class="input-group">
                    <label>ü•§ –ü–ª–∞—Å—Ç–∏–∫ (–∫–≥):</label>
                    <input type="number" id="plasticWaste" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–≥" min="0">
                </div>
                <div class="input-group">
                    <label>üç∂ –°—Ç–µ–∫–ª–æ (–∫–≥):</label>
                    <input type="number" id="glassWaste" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–≥" min="0">
                </div>
                <div class="input-group">
                    <label>üî© –ú–µ—Ç–∞–ª–ª (–∫–≥):</label>
                    <input type="number" id="metalWaste" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–≥" min="0">
                </div>
                <button onclick="calculateResourceSavings()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã</button>
            </div>

            <div id="batteriesRecycling" class="recycling-form">
                <div class="input-group">
                    <label>üîã –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ç–∞—Ä–µ–µ–∫ (—à—Ç):</label>
                    <input type="number" id="batteriesCount" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0">
                </div>
                <div class="battery-info">
                    <p>üí° 1 –±–∞—Ç–∞—Ä–µ–π–∫–∞ –∑–∞–≥—Ä—è–∑–Ω—è–µ—Ç 20 –º¬≤ –∑–µ–º–ª–∏ –∏ 400 –ª –≤–æ–¥—ã</p>
                </div>
                <button onclick="calculateBatteriesSavings()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç</button>
            </div>

            <div id="bottlesRecycling" class="recycling-form">
                <div class="input-group">
                    <label>ü•§ –ü–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ –±—É—Ç—ã–ª–∫–∏ (—à—Ç):</label>
                    <input type="number" id="plasticBottles" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0">
                </div>
                <div class="input-group">
                    <label>üç∂ –°—Ç–µ–∫–ª—è–Ω–Ω—ã–µ –±—É—Ç—ã–ª–∫–∏ (—à—Ç):</label>
                    <input type="number" id="glassBottles" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0">
                </div>
                <div class="input-group">
                    <label>ü•´ –ê–ª—é–º–∏–Ω–∏–µ–≤—ã–µ –±–∞–Ω–∫–∏ (—à—Ç):</label>
                    <input type="number" id="aluminumCans" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" min="0">
                </div>
                <button onclick="calculateBottlesSavings()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —ç–∫–æ–Ω–æ–º–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤</button>
            </div>

            <div id="recyclingResult" class="result savings-result"></div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —É–≥–ª–µ—Ä–æ–¥–Ω–æ–≥–æ —Å–ª–µ–¥–∞ -->
        <section class="calculator">
            <h2>üåç –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —É–≥–ª–µ—Ä–æ–¥–Ω–æ–≥–æ —Å–ª–µ–¥–∞</h2>
            <div class="calc-form">
                <div class="input-group">
                    <label>üöó –ü—Ä–æ–±–µ–≥ –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ –≤ –º–µ—Å—è—Ü (–∫–º):</label>
                    <input type="number" id="carKm" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–∏–ª–æ–º–µ—Ç—Ä—ã">
                </div>
                <div class="input-group">
                    <label>üí° –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏ –≤ –º–µ—Å—è—Ü (–∫–í—Ç¬∑—á):</label>
                    <input type="number" id="electricity" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–í—Ç¬∑—á">
                </div>
                <div class="input-group">
                    <label>‚úàÔ∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–ª–µ—Ç–æ–≤ –≤ –≥–æ–¥:</label>
                    <input type="number" id="flights" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–ª–µ—Ç–æ–≤">
                </div>
                <button onclick="calculateCarbonFootprint()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —É–≥–ª–µ—Ä–æ–¥–Ω—ã–π —Å–ª–µ–¥</button>
                <div id="carbonResult" class="result"></div>
            </div>
        </section>
    </main>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="app.js"></script>
    <script src="calculator.js"></script>
    <script src="historical-map.js"></script>
    
    <script>
        // –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è historical-map.js (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è)
        class HistoricalPollutionMap {
            constructor() {
                this.currentYear = 2024;
                this.currentDataType = 'air';
                this.currentMarkers = [];
                this.initMap();
            }

            initMap() {
                const mapContainer = document.getElementById('pollutionMap');
                if (!mapContainer) return;

                try {
                    this.map = L.map('pollutionMap').setView([55.7558, 37.6173], 3);
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors',
                        maxZoom: 18
                    }).addTo(this.map);

                    this.setupEventListeners();
                    this.loadDataForYear(this.currentYear);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã:', error);
                }
            }

            setupEventListeners() {
                const yearSlider = document.getElementById('yearSlider');
                const yearDisplay = document.getElementById('currentYearDisplay');
                
                if (yearSlider && yearDisplay) {
                    yearSlider.addEventListener('input', (e) => {
                        this.currentYear = parseInt(e.target.value);
                        yearDisplay.textContent = this.currentYear;
                        this.loadDataForYear(this.currentYear);
                    });
                }

                document.querySelectorAll('.data-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.data-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentDataType = e.target.dataset.type;
                        this.loadDataForYear(this.currentYear);
                        this.updateLegend();
                    });
                });

                this.updateLegend();
            }

            loadDataForYear(year) {
                const data = this.getMockData(year);
                this.renderDataOnMap(data);
                this.updateStats(data);
            }

            getMockData(year) {
                if (this.currentDataType === 'air') {
                    return this.getMockAirData(year);
                } else {
                    return this.getMockWaterData(year);
                }
            }

            getMockAirData(year) {
                const cities = [
                    { name: "–ú–æ—Å–∫–≤–∞", lat: 55.7558, lng: 37.6173, country: "–†–æ—Å—Å–∏—è" },
                    { name: "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", lat: 59.9343, lng: 30.3351, country: "–†–æ—Å—Å–∏—è" },
                    { name: "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", lat: 55.0084, lng: 82.9357, country: "–†–æ—Å—Å–∏—è" },
                    { name: "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", lat: 56.8389, lng: 60.6057, country: "–†–æ—Å—Å–∏—è" },
                    { name: "–ö–∞–∑–∞–Ω—å", lat: 55.7961, lng: 49.1064, country: "–†–æ—Å—Å–∏—è" }
                ];

                const data = cities.map(city => {
                    const yearFactor = (year - 1800) / (2024 - 1800);
                    const basePM25 = 5 + yearFactor * 45;
                    const randomFactor = 0.7 + Math.random() * 0.6;
                    const pm25 = Math.round(basePM25 * randomFactor);
                    
                    return {
                        coordinates: { latitude: city.lat, longitude: city.lng },
                        location: city.name,
                        city: city.name,
                        country: city.country,
                        measurements: [
                            { parameter: 'pm25', value: pm25 },
                            { parameter: 'so2', value: Math.round(10 + yearFactor * 50) },
                            { parameter: 'no2', value: Math.round(8 + yearFactor * 42) }
                        ]
                    };
                });
                
                return {
                    data: data,
                    globalParameters: {
                        co2: 280 + Math.round((year - 1800) * 0.67),
                        so2: 5 + Math.round((year - 1800) * 0.23),
                        no2: 3 + Math.round((year - 1800) * 0.19)
                    }
                };
            }

            getMockWaterData(year) {
                const points = [
                    { name: "–í–æ–ª–≥–∞", lat: 56.1309, lng: 44.0002, country: "–†–æ—Å—Å–∏—è" },
                    { name: "–î–Ω–µ–ø—Ä", lat: 50.4501, lng: 30.5234, country: "–£–∫—Ä–∞–∏–Ω–∞" },
                    { name: "–î–æ–Ω", lat: 47.2226, lng: 39.7187, country: "–†–æ—Å—Å–∏—è" },
                    { name: "–û–±—å", lat: 55.0113, lng: 82.9346, country: "–†–æ—Å—Å–∏—è" }
                ];
                
                const data = points.map(point => {
                    const yearFactor = (year - 1800) / (2024 - 1800);
                    const basePollution = 5 + yearFactor * 30;
                    const randomFactor = 0.8 + Math.random() * 0.4;
                    const pollution = basePollution * randomFactor;
                    
                    return {
                        ...point,
                        pollution: pollution,
                        year: year
                    };
                });
                
                const totalPollution = data.reduce((sum, point) => sum + point.pollution, 0);
                const averagePollution = totalPollution / data.length;
                
                return {
                    points: data,
                    year: year,
                    totalPoints: data.length,
                    averagePollution: averagePollution
                };
            }

            renderDataOnMap(data) {
                this.clearMarkers();
                
                if (this.currentDataType === 'air') {
                    this.renderAirQuality(data);
                } else {
                    this.renderWaterQuality(data);
                }
            }

            clearMarkers() {
                if (this.currentMarkers && this.currentMarkers.length > 0) {
                    this.currentMarkers.forEach(marker => {
                        if (marker && this.map.hasLayer(marker)) {
                            this.map.removeLayer(marker);
                        }
                    });
                    this.currentMarkers = [];
                }
            }

            renderAirQuality(airData) {
                if (!airData.data || !Array.isArray(airData.data)) return;

                airData.data.forEach(station => {
                    if (!station.coordinates) return;

                    const pm25Value = station.measurements.find(m => m.parameter === 'pm25')?.value || 0;
                    const quality = this.getAirQualityByValue(pm25Value);

                    const marker = L.circleMarker([station.coordinates.latitude, station.coordinates.longitude], {
                        radius: 15,
                        fillColor: this.getAirQualityColor(quality),
                        color: '#000',
                        weight: 1,
                        opacity: 0.8,
                        fillOpacity: 0.7
                    }).addTo(this.map);

                    marker.bindPopup(`
                        <div style="min-width: 200px;">
                            <strong>${station.location}</strong><br>
                            <strong>–ì–æ—Ä–æ–¥:</strong> ${station.city}<br>
                            <strong>–°—Ç—Ä–∞–Ω–∞:</strong> ${station.country}<br>
                            <strong>–ì–æ–¥:</strong> ${this.currentYear}<br>
                            <strong>PM2.5:</strong> ${pm25Value} ¬µg/m¬≥<br>
                            <strong>–ö–∞—á–µ—Å—Ç–≤–æ:</strong> ${this.getAirQualityText(quality)}<br>
                            ${airData.globalParameters ? `<strong>–ì–ª–æ–±–∞–ª—å–Ω—ã–π CO‚ÇÇ:</strong> ${airData.globalParameters.co2} ppm` : ''}
                        </div>
                    `);

                    this.currentMarkers.push(marker);
                });
            }

            renderWaterQuality(waterData) {
                if (!waterData.points || !Array.isArray(waterData.points)) return;

                waterData.points.forEach(point => {
                    const marker = L.circleMarker([point.lat, point.lng], {
                        radius: 12,
                        fillColor: this.getWaterQualityColor(point.pollution),
                        color: '#000',
                        weight: 1,
                        opacity: 0.8,
                        fillOpacity: 0.7
                    }).addTo(this.map);

                    marker.bindPopup(`
                        <div style="min-width: 200px;">
                            <strong>${point.name}</strong><br>
                            <strong>–ì–æ–¥:</strong> ${waterData.year}<br>
                            <strong>–ó–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ:</strong> ${point.pollution.toFixed(1)}%<br>
                            <strong>–ö–∞—á–µ—Å—Ç–≤–æ:</strong> ${this.getWaterQualityText(point.pollution)}<br>
                            ${point.country ? `<strong>–°—Ç—Ä–∞–Ω–∞:</strong> ${point.country}` : ''}
                        </div>
                    `);

                    this.currentMarkers.push(marker);
                });
            }

            getAirQualityByValue(pm25) {
                if (pm25 <= 12) return 'excellent';
                if (pm25 <= 35) return 'good';
                if (pm25 <= 55) return 'moderate';
                if (pm25 <= 150) return 'poor';
                return 'very-poor';
            }

            getAirQualityColor(quality) {
                const colors = {
                    'excellent': '#00e400',
                    'good': '#ffff00',
                    'moderate': '#ff7e00',
                    'poor': '#ff0000',
                    'very-poor': '#8f3f97'
                };
                return colors[quality] || '#cccccc';
            }

            getWaterQualityColor(pollution) {
                if (pollution < 20) return '#1e90ff';
                if (pollution < 40) return '#00ced1';
                if (pollution < 60) return '#ffa500';
                return '#ff4500';
            }

            getAirQualityText(quality) {
                const texts = {
                    'excellent': '–û—Ç–ª–∏—á–Ω–æ–µ',
                    'good': '–•–æ—Ä–æ—à–µ–µ',
                    'moderate': '–£–º–µ—Ä–µ–Ω–Ω–æ–µ',
                    'poor': '–ü–ª–æ—Ö–æ–µ',
                    'very-poor': '–û—á–µ–Ω—å –ø–ª–æ—Ö–æ–µ'
                };
                return texts[quality] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            }

            getWaterQualityText(pollution) {
                if (pollution < 20) return '–û—Ç–ª–∏—á–Ω–æ–µ';
                if (pollution < 40) return '–•–æ—Ä–æ—à–µ–µ';
                if (pollution < 60) return '–£–º–µ—Ä–µ–Ω–Ω–æ–µ';
                return '–ü–ª–æ—Ö–æ–µ';
            }

            updateStats(data) {
                const statsYear = document.getElementById('statsYear');
                if (statsYear) {
                    statsYear.textContent = this.currentYear;
                }

                if (this.currentDataType === 'air') {
                    this.updateAirStats(data);
                } else {
                    this.updateWaterStats(data);
                }

                this.toggleStatsVisibility();
            }

            updateAirStats(airData) {
                const co2Value = document.getElementById('co2Value');
                const so2Value = document.getElementById('so2Value');
                const no2Value = document.getElementById('no2Value');

                if (airData.globalParameters) {
                    if (co2Value) co2Value.textContent = airData.globalParameters.co2;
                    if (so2Value) so2Value.textContent = airData.globalParameters.so2;
                    if (no2Value) no2Value.textContent = airData.globalParameters.no2;
                }
            }

            updateWaterStats(waterData) {
                const waterStationsCount = document.getElementById('waterStationsCount');
                const avgWaterPollution = document.getElementById('avgWaterPollution');

                if (waterStationsCount) waterStationsCount.textContent = waterData.totalPoints || 0;
                if (avgWaterPollution && waterData.averagePollution) {
                    avgWaterPollution.textContent = waterData.averagePollution.toFixed(1);
                }
            }

            toggleStatsVisibility() {
                const airStats = document.getElementById('airStats');
                const waterStats = document.getElementById('waterStats');
                const airLegend = document.getElementById('airLegend');
                const waterLegend = document.getElementById('waterLegend');

                if (this.currentDataType === 'air') {
                    if (airStats) airStats.style.display = 'block';
                    if (waterStats) waterStats.style.display = 'none';
                    if (airLegend) airLegend.style.display = 'block';
                    if (waterLegend) waterLegend.style.display = 'none';
                } else {
                    if (airStats) airStats.style.display = 'none';
                    if (waterStats) waterStats.style.display = 'block';
                    if (airLegend) airLegend.style.display = 'none';
                    if (waterLegend) waterLegend.style.display = 'block';
                }
            }

            updateLegend() {
                this.toggleStatsVisibility();
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('pollutionMap')) {
                try {
                    window.historicalMap = new HistoricalPollutionMap();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π –∫–∞—Ä—Ç—ã:', error);
                }
            }
        });
    </script>
</body>
</html>
